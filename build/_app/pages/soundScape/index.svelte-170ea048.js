import{S as e,i as t,s as n,e as a,t as o,k as s,c as r,a as c,g as i,d as l,n as d,b as u,f as h,F as m,N as f,G as p,X as g,A as y,Y as v,K as w,L as k,u as S,w as _,x as $,Q as b,r as A,U as C,W as I,j as T,m as E,o as L,v as R}from"../../chunks/vendor-5daa0285.js";function N(e){let t,n,g,y,v;return{c(){t=a("button"),n=o("Log in"),g=s(),this.h()},l(e){t=r(e,"BUTTON",{class:!0});var a=c(t);n=i(a,"Log in"),a.forEach(l),g=d(e),this.h()},h(){u(t,"class","login-button svelte-tm0bkf")},m(a,o){h(a,t,o),m(t,n),h(a,g,o),y||(v=f(t,"click",e[0]),y=!0)},p:p,i:p,o:p,d(e){e&&l(t),e&&l(g),y=!1,v()}}}const U="spotify_auth_state";function x(e){const t=g();y((()=>{n()}));const n=()=>{let e=function(){for(var e,t={},n=/([^&;=]+)=?([^&;]*)/g,a=window.location.hash.substring(1);e=n.exec(a);)t[e[1]]=decodeURIComponent(e[2]);return t}(),n=e.access_token,a=e.state,o=localStorage.getItem(U);!n||null!==a&&a===o?(localStorage.removeItem(U),n&&t("accessTokenRecieved",{token:n})):alert("There was an error during the authentication")};return[e=>{e.preventDefault();var t=function(e){for(var t="",n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",a=0;a<e;a++)t+=n.charAt(Math.floor(Math.random()*n.length));return t}(16);localStorage.setItem(U,t);var n="https://accounts.spotify.com/authorize";n+="?response_type=token",n+="&client_id="+encodeURIComponent("d6aba07484274df39a3fda627e8bc331"),n+="&scope="+encodeURIComponent("streaming user-read-email user-read-private"),n+="&redirect_uri="+encodeURIComponent("http://localhost:8080/soundScape"),n+="&state="+encodeURIComponent(t),window.location=n}]}class D extends e{constructor(e){super(),t(this,e,x,N,n,{})}}function O(e){let t,n,a,o,s=!1,r=null;const c=g();y((()=>{o=localStorage.getItem("ACCESS_TOKEN"),void 0!==o?(i(),l()):console.error("no valid access token provided")}));const i=()=>{a=new v,a.setAccessToken(o)},l=()=>{t=document.createElement("script"),t.src="https://sdk.scdn.co/spotify-player.js",t.async=!1,t.defer=!0,document.head.append(t),window.onSpotifyWebPlaybackSDKReady=()=>{n=new Spotify.Player({name:"Sound Scape Player",getOAuthToken:e=>{e(o)}}),n.addListener("initialization_error",(({message:e})=>{console.error(e)})),n.addListener("authentication_error",(({message:e})=>{console.error(e)})),n.addListener("account_error",(({message:e})=>{console.error(e)})),n.addListener("playback_error",(({message:e})=>{console.error(e)})),n.addListener("player_state_changed",(({track_window:e})=>{if(null!==e&&e){s=!1;const{current_track:t}=e;if(t.id){if(t.id===r)return;d({id:t.id}),r=t.id}}})),n.addListener("ready",(({device_id:e})=>{console.log("Ready with Device ID",e),setTimeout((()=>{fetch("https://api.spotify.com/v1/me/player",{method:"PUT",body:JSON.stringify({device_ids:[e],play:!1}),headers:{Authorization:`Bearer ${o}`}}).catch((e=>console.error(e)))}),100)})),n.addListener("not_ready",(({device_id:e})=>{console.log("Device ID has gone offline",e)})),n.connect()}},d=({id:e})=>{!1===s&&a.getAudioAnalysisForTrack(e).then((e=>{c("audioAnalysisComplete",{data:e}),s=!0}))};return[]}class z extends e{constructor(e){super(),t(this,e,O,null,n,{})}}function K(){return new Worker("/_app/assets/timbre1dWorker.25c41cc6.js",{type:"module"})}const{window:W}=b;function j(e){let t,n;return t=new z({}),t.$on("audioAnalysisComplete",e[6]),{c(){T(t.$$.fragment)},l(e){E(t.$$.fragment,e)},m(e,a){L(t,e,a),n=!0},p:p,i(e){n||($(t.$$.fragment,e),n=!0)},o(e){S(t.$$.fragment,e),n=!1},d(e){R(t,e)}}}function M(e){let t,n;return t=new D({}),t.$on("accessTokenRecieved",e[5]),{c(){T(t.$$.fragment)},l(e){E(t.$$.fragment,e)},m(e,a){L(t,e,a),n=!0},p:p,i(e){n||($(t.$$.fragment,e),n=!0)},o(e){S(t.$$.fragment,e),n=!1},d(e){R(t,e)}}}function P(e){let t,n,o,i,p,g,y,v,b,C;const I=[M,j],T=[];function E(e,t){return null===e[4]?0:1}return p=E(e),g=T[p]=I[p](e),{c(){t=s(),n=a("main"),o=a("canvas"),i=s(),g.c(),this.h()},l(e){t=d(e),n=r(e,"MAIN",{class:!0});var a=c(n);o=r(a,"CANVAS",{class:!0}),c(o).forEach(l),i=d(a),g.l(a),a.forEach(l),this.h()},h(){u(o,"class","webgl-canvas svelte-q6ubty"),u(n,"class","sketch svelte-q6ubty"),w((()=>e[10].call(n)))},m(a,s){h(a,t,s),h(a,n,s),m(n,o),e[8](o),m(n,i),T[p].m(n,null),e[9](n),y=k(n,e[10].bind(n)),v=!0,b||(C=f(W,"resize",e[7]),b=!0)},p(e,[t]){let a=p;p=E(e),p===a?T[p].p(e,t):(A(),S(T[a],1,1,(()=>{T[a]=null})),_(),g=T[p],g?g.p(e,t):(g=T[p]=I[p](e),g.c()),$(g,1),g.m(n,null))},i(e){v||($(g),v=!0)},o(e){S(g),v=!1},d(a){a&&l(t),a&&l(n),e[8](null),T[p].d(),e[9](null),y(),b=!1,C()}}}function q(e,t,n){let a,o,s,r=2,c=2,i=null;y((async()=>{l(),n(4,i=localStorage.getItem("ACCESS_TOKEN")),await C(),d()}));const l=()=>{s=new K,s.onmessage=e=>{console.log(e.data)}},d=()=>{window.requestAnimationFrame((()=>d())),performance.now()};return[a,o,r,c,i,e=>{const{token:t}=e.detail;n(4,i=t),localStorage.setItem("ACCESS_TOKEN",i)},e=>{const{data:t}=e.detail;s.postMessage(t)},()=>{undefined.onresize({width:r,height:c})},function(e){I[e?"unshift":"push"]((()=>{o=e,n(1,o)}))},function(e){I[e?"unshift":"push"]((()=>{a=e,n(0,a)}))},function(){r=this.clientWidth,c=this.clientHeight,n(2,r),n(3,c)}]}export default class extends e{constructor(e){super(),t(this,e,q,P,n,{})}}
